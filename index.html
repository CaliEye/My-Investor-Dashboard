<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CyberSci-Dash v2 | Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Investor Command HUD - Real-time market dashboard for actionable investing.">
  <link rel="stylesheet" href="css/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="icon" href="images/favicon.ico">
  <script src="jsscripts.js/jsscripts.js"></script>
</head>
<body class="bg-gray-900 text-white font-inter">
  <header class="px-6 py-4 flex justify-between items-center border-b border-cyan-400 shadow-lg">
    <h1 class="text-3xl font-orbitron tracking-widest text-cyan-400">CyberSci-Dash v2</h1>
    <nav class="space-x-6 text-lg font-orbitron tracking-wide">
      <a href="index.html" class="text-pink-400 border-b-2 border-pink-400 pb-1" aria-label="Dashboard">Dashboard</a>
      <a href="warroom.html" class="hover:text-cyan-400" aria-label="War Room">War Room</a>
      <a href="macro.html" class="hover:text-cyan-400" aria-label="Macro">Macro</a>
      <a href="crypto.html" class="hover:text-cyan-400" aria-label="Crypto">Crypto</a>
      <a href="sentiment.html" class="hover:text-cyan-400" aria-label="Sentiment">Sentiment</a>
      <a href="senario.html" class="hover:text-cyan-400" aria-label="Scenario Builder">Scenario Builder</a>
      <a href="insights.html" class="hover:text-cyan-400" aria-label="Insights">Insights</a>
      <a href="links.html" class="hover:text-cyan-400" aria-label="Quick Links">Quick Links</a>
    </nav>
  </header>

  <main class="p-6 max-w-7xl mx-auto">
    <!-- Regime + Trigger Card -->
    <section class="mb-8 rounded-2xl border-2 border-cyan-400 shadow-cyan-400/40 shadow-xl bg-gradient-to-br from-gray-900 via-gray-800 to-cyan-900 px-8 py-7">
      <h2 class="text-2xl font-orbitron text-cyan-300 mb-4 tracking-widest">InvestorOS — Regime</h2>

      <div class="grid md:grid-cols-3 gap-6">
        <div class="p-4 rounded-xl border border-cyan-400/60 bg-gray-900/40">
          <div class="text-sm text-gray-300">Bias</div>
          <div id="biasState" class="text-2xl font-bold">…</div>
          <div class="text-xs text-gray-400 mt-2">Updated: <span id="lastUpdate">…</span></div>
        </div>

        <div class="p-4 rounded-xl border border-cyan-400/60 bg-gray-900/40">
          <div class="text-sm text-gray-300 mb-2">Top Triggers</div>
          <ul class="space-y-1 text-sm">
            <li><span id="t1">…</span></li>
            <li><span id="t2">…</span></li>
            <li><span id="t3">…</span></li>
          </ul>
        </div>

        <div class="p-4 rounded-xl border border-cyan-400/60 bg-gray-900/40">
          <div class="text-sm text-gray-300">Next Review</div>
          <div id="nextReview" class="text-xl font-semibold">…</div>
          <div class="text-xs text-gray-400 mt-2">Rule: no action without 2+ confirmations</div>
        </div>
      </div>
    </section>

    <!-- AI Intelligence Section -->
    <section class="mb-8 rounded-2xl border-2 border-emerald-400 shadow-emerald-400/40 shadow-xl bg-gradient-to-br from-gray-900 via-gray-800 to-emerald-900 px-8 py-7">
      <h2 class="text-2xl font-orbitron text-emerald-300 mb-6 tracking-widest">AI Intelligence</h2>
      
      <div class="grid lg:grid-cols-3 gap-6">
        <!-- ChatGPT Analysis -->
        <div class="lg:col-span-2 space-y-6">
          <div class="p-5 rounded-xl border border-emerald-400/60 bg-gray-900/40">
            <div class="flex items-center mb-3">
              <div class="bg-emerald-500 h-2 w-2 rounded-full mr-3"></div>
              <h3 class="text-lg font-orbitron text-emerald-300">ChatGPT Regime Analysis</h3>
            </div>
            <div id="chatgpt-analysis" class="text-gray-100 leading-relaxed">Loading analysis...</div>
          </div>
          
          <div class="p-5 rounded-xl border border-orange-400/60 bg-gray-900/40">
            <div class="flex items-center mb-3">
              <div class="bg-orange-500 h-2 w-2 rounded-full mr-3"></div>
              <h3 class="text-lg font-orbitron text-orange-300">Grok Alternative View</h3>
            </div>
            <div id="grok-analysis" class="text-gray-100 leading-relaxed">Loading contrarian perspective...</div>
          </div>
        </div>
        
        <!-- Action Dashboard -->
        <div class="space-y-6">
          <div class="p-5 rounded-xl border border-emerald-400/60 bg-gray-900/40">
            <h3 class="text-lg font-orbitron text-emerald-300 mb-4">Confluence Score</h3>
            <div class="flex items-center justify-center mb-3">
              <div id="confluence-gauge" class="relative">
                <div class="w-24 h-24 rounded-full border-4 border-gray-600 relative">
                  <div id="confluence-fill" class="absolute inset-0 rounded-full" style="background: conic-gradient(#10b981 0deg, #10b981 72deg, #374151 72deg, #374151 360deg);"></div>
                  <div class="absolute inset-2 bg-gray-900 rounded-full flex items-center justify-center">
                    <span id="confluence-value" class="text-2xl font-bold text-emerald-300">7</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="text-center text-sm text-gray-300">Signal Strength</div>
          </div>
          
          <div class="p-5 rounded-xl border border-yellow-400/60 bg-gray-900/40">
            <h3 class="text-lg font-orbitron text-yellow-300 mb-3">Action Bias</h3>
            <div id="action-bias" class="text-gray-100 text-sm leading-relaxed">Loading recommendations...</div>
            <div class="mt-4 text-xs text-gray-400">
              Last AI Update: <span id="ai-last-update">—</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Hero HUD Section -->
    <section class="mb-8 rounded-2xl border-2 border-cyan-400 shadow-cyan-400/40 shadow-xl bg-gradient-to-br from-gray-900 via-gray-800 to-cyan-900 px-8 py-7">
      <div class="flex flex-col md:flex-row md:space-x-12">
        <!-- Cycle Status Block -->
        <div class="flex-1 mb-8 md:mb-0">
          <h2 class="text-2xl font-orbitron text-cyan-300 mb-4 tracking-widest">Cycle Status</h2>
          <table class="w-full text-center cycle-table mb-2" aria-label="Cycle Status Table">
            <thead>
              <tr>
                <th>Cycle</th>
                <th>Count</th>
                <th>Completed</th>
                <th>Avg Cycle</th>
                <th>Direction</th>
                <th>Confidence</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>60-Day</td>
                <td>4</td>
                <td>
                  <div class="prog-bar"><div style="width:7%"></div></div>7%
                </td>
                <td>58d</td>
                <td><span class="text-green-400 font-bold">&#8593; Rising</span></td>
                <td><span class="text-cyan-400 font-bold">High</span></td>
                <td><span class="status-dot inline-block bg-green-400"></span></td>
              </tr>
              <tr>
                <td>Weekly</td>
                <td>9</td>
                <td>
                  <div class="prog-bar"><div style="width:36%"></div></div>36%
                </td>
                <td>25w</td>
                <td><span class="text-green-400 font-bold">&#8593; Rising</span></td>
                <td><span class="text-cyan-400 font-bold">High</span></td>
                <td><span class="status-dot inline-block bg-green-400"></span></td>
              </tr>
              <tr>
                <td>4-Year</td>
                <td>31</td>
                <td>
                  <div class="prog-bar"><div style="width:65%"></div></div>65%
                </td>
                <td>48mo</td>
                <td><span class="text-green-400 font-bold">&#8593; Rising</span></td>
                <td><span class="text-cyan-400 font-bold">High</span></td>
                <td><span class="status-dot inline-block bg-green-400"></span></td>
              </tr>
            </tbody>
          </table>
          <div class="mt-3 text-gray-200 text-xs">
            <strong>Note:</strong> End of cycle may fake out before reversal.<br>
            Confidence can change based on price action. Status is guidance, not absolute.
          </div>
        </div>
        <!-- Live Market Gauges -->
        <div class="flex-1 space-y-6">
          <div class="bg-gray-800 border border-cyan-500 rounded-xl p-4 shadow">
            <h3 class="font-orbitron text-lg text-cyan-300 mb-2">Market Overview</h3>
            <div class="grid grid-cols-2 gap-3 text-base">
              <div>BTC Price:</div> <div id="btc-price" class="font-bold text-yellow-300" aria-live="polite">...</div>
              <div>ETH Price:</div> <div id="eth-price" class="font-bold text-green-300" aria-live="polite">...</div>
              <div>SPX:</div> <div id="spx-latest" class="font-bold text-blue-300" aria-live="polite">...</div>
              <div>USD Index:</div> <div id="usd-latest" class="font-bold text-cyan-300" aria-live="polite">...</div>
              <div>Fear &amp; Greed:</div> <div id="fg-latest" class="font-bold text-pink-400" aria-live="polite">...</div>
            </div>
          </div>
          <div class="flex flex-row space-x-4">
            <div class="bg-gray-800 border border-green-500 rounded-xl p-4 flex-1 shadow">
              <h3 class="font-orbitron text-lg text-green-300 mb-2">Crypto Risk</h3>
              <div id="crypto-risk-gauge" class="gauge-meter"></div>
            </div>
            <div class="bg-gray-800 border border-yellow-500 rounded-xl p-4 flex-1 shadow">
              <h3 class="font-orbitron text-lg text-yellow-300 mb-2">Macro Risk</h3>
              <div id="macro-risk-gauge" class="gauge-meter"></div>
            </div>
          </div>
        </div>
      </div>
      <!-- Alert Ticker -->
      <div class="mt-6 border-t border-cyan-700 pt-3">
        <marquee behavior="scroll" direction="left" scrollamount="6" class="text-pink-400 text-lg font-bold tracking-wide">
          ALERT: Macro Risk Elevated | BTC breaks above 50 DMA | US10Y spiking | Fed statement at 2pm | ...
        </marquee>
      </div>
    </section>

    <!-- Dashboard Action Panel -->
    <section class="mb-10 flex flex-col md:flex-row md:space-x-6">
      <div class="flex-1 mb-8 md:mb-0 bg-gray-800 border border-pink-400 rounded-xl shadow p-6">
        <h2 class="text-xl font-orbitron text-pink-400 mb-2">Current Playbook</h2>
        <ul class="list-disc list-inside text-lg space-y-2">
          <li>Trend: <span class="font-bold text-green-300">Uptrend</span> (Stay long, trail stops)</li>
          <li>Risk: <span class="font-bold text-yellow-300">Moderate</span> (Scale in, consider partial profit)</li>
          <li>Action: <span class="font-bold text-cyan-300">Monitor macro triggers, no full risk</span></li>
        </ul>
        <div class="mt-4 text-gray-300 text-sm">
          <strong>Today’s Guidance:</strong> <span class="text-white">Follow your plan, avoid FOMO, update your scenario in the War Room if conditions change.</span>
        </div>
      </div>
      <div class="flex-1 bg-gray-800 border border-cyan-400 rounded-xl shadow p-6">
        <h2 class="text-xl font-orbitron text-cyan-400 mb-2">Market News</h2>
        <ul class="list-inside text-base space-y-1">
          <li>• CPI print due tomorrow</li>
          <li>• FOMC meeting next Wednesday</li>
          <li>• ETH ETF approval rumors circulating</li>
          <li>• Watch for BTC options expiry Friday</li>
        </ul>
        <div class="mt-2 text-gray-400 text-xs">News auto-updates every hour. <a href="macro.html" class="underline text-pink-400">See macro page for details &rarr;</a></div>
      </div>
    </section>

    <!-- Operational Logs -->
    <section class="mb-10 rounded-2xl border-2 border-purple-400 shadow-purple-400/40 shadow-xl bg-gradient-to-br from-gray-900 via-gray-800 to-purple-900 px-8 py-7">
      <h2 class="text-2xl font-orbitron text-purple-300 mb-6 tracking-widest">Operational Intelligence</h2>
      
      <div class="grid lg:grid-cols-2 gap-6">
        <!-- Weekly Scans -->
        <div class="bg-gray-800/60 border border-purple-500/50 rounded-xl p-6">
          <h3 class="text-lg font-orbitron text-purple-300 mb-4 flex items-center">
            <span class="bg-purple-500 h-2 w-2 rounded-full mr-3"></span>Latest Market Scans
          </h3>
          <div id="weekly-scans-content" class="space-y-4">
            <div class="text-gray-300 text-sm">Loading latest scans...</div>
          </div>
          <div class="mt-4 text-right">
            <a href="logs/weekly_scans.md" class="text-purple-400 text-sm hover:text-purple-300" target="_blank">View Full History →</a>
          </div>
        </div>

        <!-- Command Log -->
        <div class="bg-gray-800/60 border border-purple-500/50 rounded-xl p-6">
          <h3 class="text-lg font-orbitron text-purple-300 mb-4 flex items-center">
            <span class="bg-purple-500 h-2 w-2 rounded-full mr-3"></span>Recent Commands
          </h3>
          <div id="command-log-content" class="space-y-4">
            <div class="text-gray-300 text-sm">Loading recent commands...</div>
          </div>
          <div class="mt-4 text-right">
            <a href="logs/command_log.md" class="text-purple-400 text-sm hover:text-purple-300" target="_blank">View Full History →</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Quick Panel Shortcuts -->
    <section class="flex flex-wrap gap-6 mb-10 justify-center">
      <a href="warroom.html" class="hud-action bg-pink-500 hover:bg-pink-700" aria-label="Enter War Room">Enter War Room</a>
      <a href="senario.html" class="hud-action bg-cyan-500 hover:bg-cyan-700" aria-label="Scenario Builder">Scenario Builder</a>
      <a href="insights.html" class="hud-action bg-yellow-500 hover:bg-yellow-700" aria-label="Get Insights">Get Insights</a>
      <a href="links.html" class="hud-action bg-green-500 hover:bg-green-700" aria-label="Quick Links">Quick Links</a>
    </section>
  </main>

  <footer class="text-center text-gray-400 mt-8 mb-3 text-sm">
    &copy; 2025 CyberSci-Dash. All rights reserved.
  </footer>

  <script>
    async function loadData() {
      const res = await fetch("./data/data.json", { cache: "no-store" });
      const d = await res.json();

      const fmt = (x) => (x === null || x === undefined) ? "—" : x;

      // Prices (if you're displaying them)
      if (document.getElementById("btcPrice")) document.getElementById("btcPrice").textContent = fmt(d.btc_usd);
      if (document.getElementById("ethPrice")) document.getElementById("ethPrice").textContent = fmt(d.eth_usd);

      // Regime card
      if (document.getElementById("biasState")) document.getElementById("biasState").textContent = fmt(d.bias);
      if (document.getElementById("lastUpdate")) document.getElementById("lastUpdate").textContent = fmt(d.updated_utc);
      if (document.getElementById("nextReview")) document.getElementById("nextReview").textContent = fmt(d.next_review_utc);

      const ts = Array.isArray(d.triggers) ? d.triggers : [];
      if (document.getElementById("t1")) document.getElementById("t1").textContent = ts[0] || "—";
      if (document.getElementById("t2")) document.getElementById("t2").textContent = ts[1] || "—";
      if (document.getElementById("t3")) document.getElementById("t3").textContent = ts[2] || "—";
    }
    
    // Parse markdown log entries
    function parseLogEntries(markdown, isCommandLog = false) {
      const entries = [];
      const lines = markdown.split('\n');
      let currentEntry = null;
      
      for (const line of lines) {
        if (line.startsWith('## 2026-')) {
          if (currentEntry) entries.push(currentEntry);
          currentEntry = {
            date: line.replace('## ', '').trim(),
            content: []
          };
        } else if (currentEntry && line.trim()) {
          if (isCommandLog) {
            // Parse command log format
            if (line.startsWith('- **CMD**:')) {
              currentEntry.cmd = line.replace('- **CMD**: ', '').trim();
            } else if (line.startsWith('- **REASON**:')) {
              currentEntry.reason = line.replace('- **REASON**: ', '').trim();
            } else if (line.startsWith('- **SIZE**:')) {
              currentEntry.size = line.replace('- **SIZE**: ', '').trim();
            }
          } else {
            // Parse weekly scans format
            currentEntry.content.push(line.trim());
          }
        }
      }
      if (currentEntry) entries.push(currentEntry);
      return entries.slice(0, 3); // Latest 3
    }
    
    async function loadLogs() {
      try {
        // Load weekly scans
        const scansRes = await fetch('./logs/weekly_scans.md');
        const scansText = await scansRes.text();
        const scanEntries = parseLogEntries(scansText);
        
        const scansHtml = scanEntries.map(entry => `
          <div class="border-l-2 border-purple-500 pl-3 py-2">
            <div class="text-purple-300 text-xs font-mono">${entry.date}</div>
            <div class="text-gray-100 text-sm mt-1">${entry.content.slice(0, 3).join('<br>')}</div>
          </div>
        `).join('');
        
        document.getElementById('weekly-scans-content').innerHTML = scansHtml;
        
        // Load command log
        const commandRes = await fetch('./logs/command_log.md');
        const commandText = await commandRes.text();
        const commandEntries = parseLogEntries(commandText, true);
        
        const commandHtml = commandEntries.map(entry => `
          <div class="border-l-2 border-purple-500 pl-3 py-2">
            <div class="text-purple-300 text-xs font-mono">${entry.date}</div>
            <div class="text-orange-300 text-sm font-bold">${entry.cmd || 'Command'}</div>
            <div class="text-gray-200 text-xs mt-1">${entry.reason || entry.size || ''}</div>
          </div>
        `).join('');
        
        document.getElementById('command-log-content').innerHTML = commandHtml;
        
      } catch (error) {
        console.error('Error loading logs:', error);
        document.getElementById('weekly-scans-content').innerHTML = '<div class="text-red-400 text-sm">Error loading scan logs</div>';
        document.getElementById('command-log-content').innerHTML = '<div class="text-red-400 text-sm">Error loading command logs</div>';
      }
    }
    
    async function loadAIInsights() {
      try {
        const res = await fetch('./data/ai_insights.json', { cache: 'no-store' });
        const ai = await res.json();
        
        // Update ChatGPT analysis section
        if (document.getElementById('chatgpt-analysis')) {
          const regime = ai.regime || 'No regime available';
          const triggers = Array.isArray(ai.top_triggers) ? ai.top_triggers : ['—', '—', '—'];
          const invalidation = ai.invalidation || 'No invalidation specified';
          
          const contextualGuidance = ai.contextual_guidance || 'No guidance available';
          
          const analysisHtml = `
            <div class="mb-3">
              <strong class="text-emerald-300">Regime:</strong> ${regime}
            </div>
            <div class="mb-3">
              <strong class="text-emerald-300">Top Triggers:</strong>
              <ul class="list-disc list-inside mt-1 ml-2">
                <li>${triggers[0] || '—'}</li>
                <li>${triggers[1] || '—'}</li>
                <li>${triggers[2] || '—'}</li>
              </ul>
            </div>
            <div class="mb-3">
              <strong class="text-red-300">Invalidation:</strong> ${invalidation}
            </div>
            <div class="border-t border-emerald-700 pt-3 mt-3">
              <strong class="text-cyan-300">Portfolio Action:</strong>
              <div class="text-gray-100 mt-1">${contextualGuidance}</div>
            </div>
          `;
          
          document.getElementById('chatgpt-analysis').innerHTML = analysisHtml;
        }
        
        // Update Grok analysis  
        if (document.getElementById('grok-analysis')) {
          const counterView = ai.grok_counter || 'No alternative view available';
          document.getElementById('grok-analysis').textContent = counterView;
        }
        
        // Update confidence score and gauge
        if (document.getElementById('confluence-value')) {
          const score = ai.confidence_score || 0;
          document.getElementById('confluence-value').textContent = score;
          
          // Update gauge visual (0-10 scale)
          const percentage = (score / 10) * 360;
          const fill = document.getElementById('confluence-fill');
          if (fill) {
            let color;
            if (score <= 3) color = '#ef4444'; // red
            else if (score <= 6) color = '#f59e0b'; // yellow  
            else color = '#10b981'; // green
            
            fill.style.background = `conic-gradient(${color} 0deg, ${color} ${percentage}deg, #374151 ${percentage}deg, #374151 360deg)`;
          }
        }
        
        // Update action bias (simplified)
        if (document.getElementById('action-bias')) {
          const confidence = ai.confidence_score || 0;
          const regime = (ai.regime || '').toLowerCase();
          
          let actionText;
          if (confidence >= 8) {
            actionText = regime.includes('bull') ? 
              'High conviction: Add risk on pullbacks' : 
              'High conviction: Reduce exposure, hedge positions';
          } else if (confidence >= 5) {
            actionText = regime.includes('bull') ? 
              'Moderate bullish: Scale in carefully' :
              'Cautious: Trim positions, raise cash';
          } else {
            actionText = 'Low confidence: Wait for clearer signals';
          }
          
          document.getElementById('action-bias').textContent = actionText;
        }
        
        // Update last AI update time
        if (document.getElementById('ai-last-update')) {
          const updateTime = ai.updated_utc ? new Date(ai.updated_utc).toLocaleString() : 'Unknown';
          document.getElementById('ai-last-update').textContent = updateTime;
        }
        
      } catch (error) {
        console.error('Error loading AI insights:', error);
        // Graceful fallback
        if (document.getElementById('chatgpt-analysis')) {
          document.getElementById('chatgpt-analysis').innerHTML = '<span class="text-red-400">Error loading regime analysis</span>';
        }
        if (document.getElementById('grok-analysis')) {
          document.getElementById('grok-analysis').innerHTML = '<span class="text-red-400">Error loading counter-analysis</span>';
        }
      }
    }
    
    // Load all data
    Promise.all([loadData(), loadLogs(), loadAIInsights()]).catch(console.error);
  </script>
</body>
</html>